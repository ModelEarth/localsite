<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<title>Location Info</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">

<link rel="stylesheet" type="text/css" href="../../io/charts/bubble/css/bubble.css"/>
<script type="text/javascript" src="../js/localsite.js?display=everything&showbubbles=true&showheader=true&showsearch=true"></script>
<style>
.navlink-industries {
    font: 600 16px/1.8 "Lato", sans-serif !important;
    color: #222 !important;
}
.dark .navlink-industries {
    color: #fff !important;
}
#bubble-chart-container {
    margin: 20px 0;
    padding: 20px;
    display: none; /* Hidden by default, shown when no state selected */
}
#bubble-chart-container.show-bubble {
    display: block;
}
</style>
</head>
<body>

<!-- Bubble Chart Container - Only shown when no state is selected -->
<div id="bubble-chart-container" class="content contentpadding">
    <div id="industry-list" class="industry-list">
        <div style="float:left; margin-right:50px">
            <h2 style="border:0px">Environmental Impact</h2>
            <div id="relocatedStateMenu"></div>
            <div id="bubble-graph-title"></div>
            <text id="bubble-graph-equation"></text>
        </div>

        <!-- Bubble click info - floats to the right of the title -->
        <div id="bubble-click-info" class="floatright" style="display:none;"></div>

        <div style="clear:both"></div>

        <div id="bubble-graph-id" class="bubble-graph">
            <div style="clear:both; border-top:1px solid #999; border-bottom:1px solid #999; padding:10px; margin-bottom:10px; overflow: scroll">
                <div id="graph-wrapper-z">
                    <text class="text-space-horz">Bubble-Size</text>
                    <select id="graph-picklist-z" class="graph-picklist">
                    </select>
                    <span id="unit-z"></span>
                </div>

                <div id="graph-wrapper">
                    <div id="graph-wrapper-y">
                        <text class="text-space-vert">Y-Axis</text>
                        <select id="graph-picklist-y" class="graph-picklist">
                        </select>
                        <span id="unit-y"></span>
                    </div> 
                </div>

                <div id="graph-wrapper-x">
                    <text class="text-space-horz">X-Axis</text>
                    <select id="graph-picklist-x" class="graph-picklist">
                    </select>
                    <span id="unit-x"></span>
                </div> 
            </div>

            <div>
                <!-- css toggles checkbox, which triggers javascript -->
                <label style="float:left; margin-right:6px" class="switch">
                    <input id="mySelect" type="checkbox" checked>
                    <span class="slider round"></span>
                </label>
                <div class="switch-text">
                    Top industries within region
                </div>
            </div>
        </div>

        <button onclick="clearBubbleSelection()" style="float:right">Clear Selection</button>
        <div style="clear:both"></div>
    </div>
    <br><br>

    <div id="impactTextIntro">
        Click bubbles above to view industry impact data.
    </div>
    <div id="impactText" style="float:left"></div>
    <div style="clear:both"></div>

    <!-- Must reside after HTML -->
    <script>
        // Initialize bubble chart when page loads
        function initBubbleChart() {
            const hash = typeof getHash === 'function' ? getHash() : {};
            
            // Only show bubble chart when no state is selected
            if (!hash.state || hash.state === 'US') {
                document.getElementById('bubble-chart-container').classList.add('show-bubble');
                
                // Load bubble chart
                loadScript(theroot + '../localsite/js/d3.v5.min.js', function(results) {
                    loadScript(theroot + '../io/charts/bubble/js/bubble.js', function(results) {
                        waitForElm('#bubble-graph-id').then((elm) => {
                            if(typeof hiddenhash == 'undefined') {
                                var hiddenhash = {};
                            }
                            if(typeof hash == 'undefined') {
                                var hash = getHash();
                            }
                            
                            displayImpactBubbles(1); // Initialize bubble chart
                            toggleBubbleHighlights(hash); // Show the bubbles
                        });
                    });
                });
            } else {
                // Hide bubble chart when state is selected
                document.getElementById('bubble-chart-container').classList.remove('show-bubble');
            }
        }

        // Listen for hash changes to show/hide bubble chart
        function handleBubbleChartVisibility() {
            const hash = typeof getHash === 'function' ? getHash() : {};
            const bubbleContainer = document.getElementById('bubble-chart-container');
            
            if (!hash.state || hash.state === 'US') {
                if (!bubbleContainer.classList.contains('show-bubble')) {
                    initBubbleChart();
                }
            } else {
                bubbleContainer.classList.remove('show-bubble');
            }
        }

        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBubbleChart);
        } else {
            // DOMContentLoaded already fired
            setTimeout(initBubbleChart, 1000); // Give localsite.js time to load
        }

        // Listen for hash changes
        window.addEventListener('hashchange', handleBubbleChartVisibility);
        if (typeof document !== 'undefined') {
            document.addEventListener('hashChangeEvent', handleBubbleChartVisibility);
        }
    </script>
</div>

</body>
</html>